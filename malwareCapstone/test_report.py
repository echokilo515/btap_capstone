import requests
import time

API_KEY = "8055d92f789dfd0d2c74771b465285bf8fcfadbde85197e474afd6b1d7ef1b01"
url = "https://www.virustotal.com/api/v3/files"
bad_hash = "ca70c302c46f3b43ae900ac5ea68e1a0"
bad_hashes_path = "C:/Users/echok/OneDrive/Desktop/malwareCapstone/bad_hashes.txt"
delay_seconds = 65

print("Starting program...")

# Open the file in read mode
with open(bad_hashes_path, "r") as file:
    # Read all lines of the file
    contents = file.readlines()
    print("Found a text file...")

headers = {"accept": "application/json", "x-apikey": API_KEY}

# Open the output file in write mode
with open("test_report.txt", "w") as output_file:
    # Iterate through each hash in the file
    for line in contents:
        hash_value = line.strip()
        # Make a GET request to VirusTotal to check the hash
        response = requests.get(
            f"https://www.virustotal.com/api/v3/files/{hash_value}", headers=headers
        )

        # Print the response
        if response.status_code == 200:
            report = response.json()
            output_file.write(f"Report for hash {hash_value}:\n")
            output_file.write(f"{report}\n\n")
            print(f"Report for hash {hash_value} written to file.")
        else:
            error_message = f"No maliscious signatures detected for {hash_value}: {response.status_code} {response.text}\n"
            # output_file.write(error_message)
            # print(error_message)

        # Wait for 70 seconds before making the next request
        print(f"Waiting for {delay_seconds} seconds before the next request...")
        time.sleep(delay_seconds)

print("Complete! Report saved to virus_total_report.txt")
